# 你校 VPN 登录态自动刷新并生成 v2ray config 的程序

## 配置说明

代码根目录下有个叫`v2config.js`的，你可以把你的 v2ray 配置写进去，到时候访问这个函数就能拿到插入了最新 Cookie 的配置文件。

你仔细看，会发现`v2config.js`其实是导出了一个箭头函数，返回一个模版字符串，将入参（Cookie） 填到配置文件里

小技巧，使用以下命令即可自动从你部署的程序上拉取最新 config 并启动 v2ray

```bash
curl https://your-deploy-url/ | v2ray run -format json
```

## 部署方案

### 阿里云函数计算（推荐）

[阿里云函数计算控制台](https://fcnext.console.aliyun.com/)

#### 操作步骤

0. clone 本存储库或者下载 zip 代码包
1. 打开网站，登录/注册一个阿里云账号，进行一下[学生认证](https://account.console.aliyun.com/v2/#/student)领个￥ 300 代金券
2. 打开阿里云函数计算控制台，选到北京地域（离你校服务器近点），进入[“函数”板块](https://fcnext.console.aliyun.com/cn-beijing/functions)，创建一个“**事件函数**”，名称随便起
3. 函数代码部分，运行环境选 Node.js 20，代码上传方式选“**通过 ZIP 包上传代码**”，注意，压缩包根目录一定要是 index.mjs 所在目录，而不是压缩包内嵌套一个文件夹（即从 Github 下载的代码 ZIP 包是不能直接用的）。或者选择“**通过文件夹上传代码**”，选择代码所在的整个文件夹（而不是选择代码根目录的所有文件夹和文件）
4. 打开**高级设置**，vCPU 给 0.25，内存给 256MB 足够，其余设置不用动，确认一下**请求处理程序**写的是`index.handler`
5. 需配置函数角色，依然在函数高级设置里，点击**创建角色**，进入[阿里云 RAM 访问控制台](https://ram.console.aliyun.com/roles/create)，可信实体类型选择“**阿里云服务**”，角色类型选择默认的“**普通服务角色**”，名称随便起，选择受信服务“**函数计算**”，完成创建
6. 为刚才创建的角色授权，新增授权，选择权限-系统策略，里面搜`AliyunFCFullAccess`，确认授权
7. 回到函数创建的高级设置页面，在函数角色处刷新，然后在列表里选择刚才创建的角色名称
8. 在环境变量一栏，为函数添加环境变量，使用表单编辑，添加两个变量，键分别为`YSU_username`和`YSU_password`（键名与`index.mjs`中常量`envKeys`中的值保持一致），对应的值分别填你一网通办的账号和密码。
9. 磅 15 便士
10. 打开函数配置页面，使用阿里云自带的网页编辑器（内嵌 VSCode），打开终端，使用`npm i`安装依赖，之后**部署代码**。也可以在创建函数上传代码之前先在本地安装好依赖再一起上传。
11. 还是函数配置页面，找到网页编辑器上方一栏，在**触发器**右侧的横线上点加号，创建一个触发器，触发器类型选“**HTTP 触发器**”，名称随便写，版本或别名选“**LATEST**”，请求方法只保留 GET 即可，其余配置不用动
12. HTTP 触发器的公网访问地址即为该项目访问地址，向该地址发送 GET 请求即可拿到插入了最新 Cookie 的 v2ray 配置

### Nodejs 直接运行

还没写。
